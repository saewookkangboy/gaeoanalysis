# GAEO Analysis - 상세 기능 가이드

이 문서는 GAEO Analysis 서비스의 모든 기능을 상세히 설명합니다.

## 목차

1. [핵심 분석 기능](#핵심-분석-기능)
2. [AI Agent 시스템](#ai-agent-시스템)
3. [알고리즘 자동 학습 시스템](#알고리즘-자동-학습-시스템)
4. [사용자 경험 기능](#사용자-경험-기능)
5. [Freemium 모델](#freemium-모델)
6. [성능 및 안정성 기능](#성능-및-안정성-기능)
7. [보안 기능](#보안-기능)
8. [모니터링 및 통계](#모니터링-및-통계)

---

## 핵심 분석 기능

### 통합 점수 분석

서비스는 콘텐츠를 세 가지 차원에서 분석합니다:

#### SEO 점수 (Search Engine Optimization)
- **H1 태그**: 단일 H1 태그 존재 여부
- **Title 태그**: 60자 이내 최적화된 제목
- **Meta Description**: 160자 이내 최적화된 설명
- **Alt 텍스트**: 이미지 대체 텍스트 비율 (80% 이상)
- **구조화된 데이터**: JSON-LD 스키마 존재 여부
- **Open Graph 태그**: 소셜 미디어 공유 최적화
- **Canonical URL**: 중복 콘텐츠 방지
- **내부 링크**: 내부 링크 구조
- **헤딩 구조**: H2 태그 존재 여부

#### AEO 점수 (Answer Engine Optimization)
- **질문 형식 콘텐츠**: 질문 키워드 포함 여부
- **FAQ 섹션**: FAQ 섹션 또는 FAQPage 스키마
- **명확한 답변 구조**: H2→H3→bullets 구조 (40% 더 많은 인용)
- **키워드 밀도**: 300단어 이상의 충분한 콘텐츠
- **구조화된 답변**: 정의 목록, 테이블 등 구조화된 정보
- **콘텐츠 신선도**: 날짜 정보 및 최근 업데이트 표시
- **30일 이내 업데이트**: 3.2x 인용 증가 (Perplexity)
- **용어 설명**: 약어, 정의 태그 사용
- **통계 및 인용**: 통계 데이터 및 인용 정보 포함

#### GEO 점수 (Generative Engine Optimization)
- **콘텐츠 길이**: 충분한 단어 수 (최소 1000단어 권장)
- **다중 미디어**: 이미지, 비디오 등 다양한 미디어 포함
- **섹션 구조**: 명확한 섹션 및 아티클 구조
- **키워드 다양성**: 다양한 관련 키워드 사용
- **헤딩 계층**: H2, H3 태그를 활용한 계층적 구조
- **리스트 및 불릿**: 가독성을 위한 리스트 활용

### AI 모델별 인용 확률

각 AI 모델의 특성을 반영하여 인용 확률을 계산합니다:

#### ChatGPT
- 구조화된 데이터 선호
- FAQ 섹션 중요
- 명확한 답변 구조

#### Perplexity
- 신선도(Freshness) 중요 (30일 이내 업데이트 시 3.2x 증가)
- H2→H3→bullets 구조 선호 (40% 더 많은 인용)
- 통계 및 인용 정보 중요

#### Gemini
- 다중 미디어 콘텐츠 선호
- 긴 형식 콘텐츠 선호
- 구조화된 데이터 활용

#### Claude
- 고품질 콘텐츠 선호
- 명확한 구조와 논리적 흐름
- 신뢰할 수 있는 출처 인용

### 종합 점수

세 가지 점수의 평균을 종합 점수로 계산합니다:
- **80점 이상**: 우수
- **60-79점**: 양호
- **60점 미만**: 개선 필요

---

## AI Agent 시스템

### 고도화된 챗봇 기능

분석 결과를 기반으로 Google Gemini API 2.5 Flash를 사용하여 개선 방안에 대한 질문에 답변합니다.

#### 마크다운 렌더링
- 제목 (H1-H6)
- 리스트 (순서 있는/없는)
- 코드 블록 (구문 강조)
- 링크
- 강조 (볼드, 이탤릭)
- 인용문

#### 코드 하이라이팅
- Highlight.js를 사용한 구문 강조
- 다양한 프로그래밍 언어 지원

#### 답변 복사 기능
- 각 답변에 호버 시 복사 버튼 표시
- 클릭으로 전체 답변을 클립보드에 복사
- 복사 성공 시 토스트 알림

#### 동적 추천 질문
- 대화 맥락과 분석 결과를 학습하여 맞춤형 질문 생성
- 이미 질문한 내용과 중복되지 않도록 필터링
- 응답 후 자동으로 새로운 추천 질문 생성
- 수동 새로고침 버튼 제공

#### 실시간 피드백
- 질문 전송 시 "잠시만요, 곧 답변 드릴게요..." 메시지 표시
- 스트리밍 응답으로 긴 답변도 완전히 수집
- 로딩 상태 표시

#### 토큰 최적화
- 프롬프트 최적화로 빠른 응답 처리
- 최대 4096 토큰 제한
- 대화 이력 기반 컨텍스트 관리

#### 대화 이력 저장
- 로그인 사용자의 대화 이력 자동 저장
- 이전 대화 불러오기
- 플랜별 저장 제한

### Agent Lightning 통합

#### 프롬프트 최적화 시스템
- SEO/AEO/GEO/AIO 특화 프롬프트 자동 최적화
- 성능 기반 프롬프트 자동 개선
- 버전 관리된 프롬프트 템플릿

#### 응답 품질 평가
- 관련성 (Relevance): 0-1 점수
- 정확성 (Accuracy): 0-1 점수
- 유용성 (Usefulness): 0-1 점수
- 사용자 만족도 (선택적): 0-1 점수

#### 학습 메트릭 추적
- Agent Type별 성능 모니터링
- 개선율 계산
- 최고 성능 프롬프트 버전 추적

#### 이벤트 추적 (Spans)
- 프롬프트 추적
- 응답 추적
- Reward 추적
- 데이터베이스 영구 저장

---

## 알고리즘 자동 학습 시스템

### 자동 가중치 학습

분석 결과를 기반으로 알고리즘 가중치를 자동으로 조정합니다:

#### 특징 추출
- SEO 특징: H1 태그, Title, Meta description, Alt 텍스트 등
- AEO 특징: 질문 형식, FAQ, 답변 구조 등
- GEO 특징: 콘텐츠 길이, 미디어, 섹션 구조 등

#### 가중치 학습
- 분석 결과와 실제 성능 비교
- 가중치 자동 조정
- 버전 관리

### 리서치 결과 반영

최신 SEO/GEO/AEO 연구 결과를 알고리즘에 자동 반영:

#### 2025년 연구 기반
- 41M AI 검색 결과 분석
- 680M 인용 분석
- Claude Skill SEO/GEO Optimizer 가이드라인 통합

#### 주요 최적화 전략
- 신선도 최적화: 30일 이내 업데이트 시 3.2x 인용 증가
- H2→H3→bullets 구조: 40% 더 많은 인용
- 통계 및 인용: +41% 개선 (통계), +28% 개선 (인용)
- FAQPage 스키마: Highest AI citation probability

### A/B 테스트

여러 알고리즘 버전을 비교하여 최적 버전을 선택합니다:

#### 버전 관리
- 알고리즘 버전별 성능 추적
- 롤백 지원
- 성능 비교 대시보드

### 성능 모니터링

알고리즘별 성능 지표를 실시간으로 추적합니다:

#### 모니터링 지표
- 평균 점수
- 개선율
- 사용 횟수
- 성공률

---

## 사용자 경험 기능

### 다크 모드 지원

#### 자동 감지
- 시스템 테마 자동 감지
- 브라우저 설정 기반 초기 테마 설정

#### 수동 전환
- 테마 전환 버튼 제공
- 모든 컴포넌트 다크 모드 지원
- 부드러운 전환 애니메이션

### 반응형 디자인

#### 모바일 최적화
- 터치 친화적 인터페이스
- 모바일 네비게이션
- 작은 화면에 최적화된 레이아웃

#### 태블릿 최적화
- 중간 크기 화면에 최적화
- 적절한 여백 및 간격

#### 데스크톱 최적화
- 넓은 화면 활용
- 멀티 컬럼 레이아웃
- 호버 효과

### 토스트 알림 시스템

#### 알림 타입
- **성공**: 초록색 배경, 체크 아이콘
- **에러**: 빨간색 배경, 경고 아이콘
- **경고**: 노란색 배경, 경고 아이콘
- **정보**: 파란색 배경, 정보 아이콘

#### 자동 표시
- 분석 완료 시 자동 표시
- 에러 발생 시 자동 표시
- 일정 시간 후 자동 사라짐

### 개인화

#### 블로그 URL 연동
- 회원가입/로그인 시 블로그 URL 등록
- 로그인 시 자동으로 블로그 URL 로드
- 자동 분석 시작 옵션

#### 분석 이력
- 최근 분석 기록 조회
- 플랜별 저장 제한:
  - Free 플랜: 최근 5개
  - Pro/Business 플랜: 무제한

### 소셜 로그인

#### Google 로그인
- Google 계정으로 간편 로그인
- OAuth 2.0 인증

#### GitHub 로그인
- GitHub 계정으로 간편 로그인
- OAuth 2.0 인증

### 원클릭 복사

#### Markdown 형식
- 분석 결과를 Markdown 형식으로 변환
- 클립보드에 자동 복사
- 복사 성공 시 알림

### 네트워크 상태 모니터링

#### 실시간 표시
- 온라인/오프라인 상태 표시
- 네트워크 복구 시 알림
- 오프라인 상태 시 경고 메시지

### 진행 상태 표시

#### 단계별 진행
- URL 가져오기
- HTML 파싱
- 점수 계산
- AI 분석

#### 예상 소요 시간
- 각 단계별 예상 시간 표시
- 경과 시간 표시
- 진행률 표시

### 에러 복구

#### 자동 재시도
- 네트워크 에러 시 자동 재시도
- Exponential Backoff 적용
- 최대 3회 재시도

#### 상세한 에러 메시지
- 에러 타입별 맞춤 메시지
- 해결 방법 제시
- 재시도 버튼 제공

---

## Freemium 모델

### 구독 플랜

#### 🆓 Free 플랜
- 월간 분석: 10회
- 월간 챗봇: 20회
- AI 모델: 2개 (ChatGPT, Perplexity)
- 분석 이력: 최근 5개

#### 💎 Pro 플랜 (월 19,000원)
- 월간 분석: 무제한
- 월간 챗봇: 무제한
- AI 모델: 4개 (전체)
- 분석 이력: 무제한
- CSV/PDF 내보내기
- API 액세스
- 웹훅 알림

#### 🏢 Business 플랜 (월 99,000원)
- Pro의 모든 기능
- 팀 협업 (최대 10명)
- 공유 대시보드
- 브랜드 리포트
- 전담 지원

### 사용량 추적

#### 실시간 추적
- 월간 분석 사용량
- 월간 챗봇 사용량
- 사용량 한도 표시
- 남은 사용량 표시

### 사용량 제한

#### 플랜별 제한
- 분석 횟수 제한
- 챗봇 사용 횟수 제한
- AI 모델 제한
- 분석 이력 저장 제한

### 구독 관리

#### 구독 생성
- 플랜 선택
- 결제 처리
- 구독 활성화

#### 업그레이드
- 더 높은 플랜으로 업그레이드
- 즉시 기능 활성화
- 비례 환불 처리

#### 취소
- 구독 취소
- 만료 시까지 사용 가능
- 자동 다운그레이드

### 자동 만료 처리

#### 만료 시 처리
- 구독 만료 시 Free 플랜으로 자동 다운그레이드
- 사용량 제한 적용
- 알림 발송

---

## 성능 및 안정성 기능

### 캐싱 시스템

#### 메모리 기반 캐시
- 동일 URL 재분석 시 캐시된 결과 반환
- TTL 설정 (기본 24시간)
- 자동 만료 처리
- 캐시 통계 제공

#### 캐시 키 생성
- URL 기반 캐시 키
- 사용자별 캐시 분리
- 패턴 기반 캐시 삭제

### 레이트 리미팅

#### IP 기반 제한
- IP당 1분에 10회 요청 제한
- 초과 시 429 에러 반환
- Retry-After 헤더 제공

#### 사용자 기반 제한
- 사용자당 1시간에 50회 요청 제한
- 로그인 사용자 우선 처리
- 플랜별 차등 제한

#### 레이트 리미트 헤더
- X-RateLimit-Limit: 최대 요청 수
- X-RateLimit-Remaining: 남은 요청 수
- X-RateLimit-Reset: 리셋 시간

### 네트워크 에러 핸들링

#### 자동 재시도
- 네트워크 에러 시 자동 재시도
- Exponential Backoff 적용
- 최대 3회 재시도

#### 재시도 조건
- fetch failed
- timeout
- ECONNREFUSED
- ENOTFOUND
- AbortError

#### 타임아웃 설정
- URL fetch: 15초 타임아웃
- AbortController 사용
- 타임아웃 시 명확한 에러 메시지

### 보안 헤더

#### CORS 설정
- 허용된 도메인만 접근 가능
- 환경별 CORS 설정
- Credentials 지원

#### 보안 헤더
- X-Content-Type-Options: nosniff
- X-Frame-Options: DENY
- X-XSS-Protection: 1; mode=block
- Referrer-Policy: strict-origin-when-cross-origin

#### CSP 헤더
- OAuth 콜백 경로에만 적용
- Trusted Types 오류 해결
- 필요한 스크립트 허용

### 헬스 체크

#### 서비스 상태 확인
- 데이터베이스 연결 상태
- 외부 API 상태 (Gemini)
- 캐시 통계
- 메모리 사용량
- 시스템 업타임

#### 엔드포인트
- GET /api/health
- JSON 형식 응답
- 상태 코드: 200 (healthy), 503 (unhealthy)

---

## 보안 기능

### 인증 및 인가

#### NextAuth.js
- 세션 기반 인증
- JWT 토큰 사용
- 쿠키 기반 세션 관리

#### Firebase Authentication
- 이메일/비밀번호 인증
- 소셜 로그인 (Google, GitHub)
- 사용자 관리

### 입력 검증

#### URL 검증
- 유효한 URL 형식 검증
- 플랫폼별 URL 검증 (네이버 블로그, 브런치 등)
- XSS 방지

#### Zod 스키마 검증
- 타입 안전성 보장
- 런타임 검증
- 명확한 에러 메시지

### 데이터 보호

#### SQL Injection 방지
- Prepared Statement 사용
- 파라미터화된 쿼리
- 입력 sanitization

#### XSS 방지
- 입력 sanitization
- 출력 이스케이프
- CSP 헤더

### 트랜잭션 관리

#### 데이터 일관성
- 모든 쓰기 작업이 트랜잭션으로 보호
- 원자성 보장 (All or Nothing)
- 에러 발생 시 자동 롤백

---

## 모니터링 및 통계

### 분석 통계

#### 항목별 통계
- AEO 점수 통계
- GEO 점수 통계
- SEO 점수 통계
- AI 모델별 인용 확률 통계

#### 기간별 통계
- 시작일/종료일 지정
- 일별/주별/월별 집계
- 도메인별 통계

### 사용자 활동 통계

#### 사용자별 통계
- 분석 횟수
- 챗봇 사용 횟수
- 평균 점수
- 활동 기간

### 학습 메트릭

#### Agent Type별 메트릭
- SEO Agent 성능
- AEO Agent 성능
- GEO Agent 성능
- AIO Agent 성능

#### 메트릭 항목
- 총 Spans 수
- 평균 Reward 점수
- 개선율
- 최고 성능 프롬프트 버전

#### 통계 항목
- 평균 관련성
- 평균 정확성
- 평균 유용성
- 총 Reward 수

### 일일 통계 집계

#### 자동 집계
- 일일 통계 자동 집계
- 관리자 권한 필요
- 배치 작업으로 실행

---

## API 엔드포인트

### 분석 API
- `POST /api/analyze` - 콘텐츠 분석

### 챗봇 API
- `POST /api/chat` - AI 챗봇 질문
- `POST /api/chat/suggestions` - 추천 질문 생성
- `POST /api/chat/save` - 대화 저장
- `GET /api/chat/history` - 대화 이력 조회

### 사용자 API
- `GET /api/user/blog-url` - 블로그 URL 조회
- `POST /api/user/blog-url` - 블로그 URL 저장

### 구독 API
- `GET /api/subscription` - 구독 정보 조회
- `POST /api/subscription` - 구독 생성/업그레이드
- `DELETE /api/subscription` - 구독 취소

### 사용량 API
- `GET /api/usage` - 사용량 조회

### 분석 이력 API
- `GET /api/history` - 분석 이력 조회

### 알고리즘 API
- `POST /api/algorithm-learning` - 알고리즘 학습
- `GET /api/algorithm-performance` - 성능 조회
- `POST /api/algorithm-initialize` - 알고리즘 초기화

### 학습 메트릭 API
- `GET /api/learning-metrics` - 학습 메트릭 조회

### 통계 API
- `GET /api/statistics` - 통계 조회

### 헬스 체크 API
- `GET /api/health` - 서비스 상태 확인

---

## 데이터베이스

### 주요 테이블

#### users
- 사용자 정보
- Firebase UID 연동

#### analyses
- 분석 결과 저장
- 점수, 인사이트, AIO 분석 결과

#### chat_conversations
- 채팅 대화 저장
- 대화 이력 관리

#### subscriptions
- 구독 정보
- 플랜, 만료일, 상태

#### usage_tracking
- 사용량 추적
- 월간 분석/챗봇 사용량

#### algorithm_versions
- 알고리즘 버전 관리
- 가중치, 성능 지표

#### algorithm_performance
- 알고리즘 성능 추적
- 버전별 성능 비교

#### prompt_templates
- 프롬프트 템플릿 저장
- 버전 관리

#### agent_spans
- Agent 이벤트 추적
- 프롬프트, 응답, Reward

#### agent_rewards
- Agent Reward 저장
- 관련성, 정확성, 유용성 점수

#### learning_metrics
- 학습 메트릭 저장
- 일별 성능 추적

### 트랜잭션 관리

모든 쓰기 작업이 트랜잭션으로 보호됩니다:
- 원자성 보장
- 데이터 일관성 유지
- 에러 발생 시 자동 롤백

### 인덱싱 최적화

#### 복합 인덱스
- 사용자별 최근 분석 조회 최적화
- URL 기반 중복 검사 최적화
- 채팅 대화 조회 최적화

#### 성능 향상
- 사용자별 분석 이력 조회: 10배 이상 빠름
- 중복 분석 확인: 즉시 응답

### 마이그레이션 시스템

#### 버전 관리
- 스키마 변경 버전 관리
- 자동 마이그레이션 실행
- 롤백 지원

---

## 개발 도구

### 데이터베이스 관리
- `npm run db:migrate` - 마이그레이션 실행
- `npm run db:backup` - 데이터베이스 백업
- `npm run db:restore` - 데이터베이스 복구
- `npm run db:optimize` - 데이터베이스 최적화

### 개발 서버
- `npm run dev` - 개발 서버 실행
- `npm run dev:clean` - 정리 후 개발 서버 실행
- `npm run cleanup` - 개발 서버 정리
- `npm run cleanup:all` - 전체 정리

### 기타 도구
- `npm run push` - 자동 Git 푸시
- `npm run stats:aggregate` - 일일 통계 집계

---

## 참고 문서

- [README.md](./README.md) - 프로젝트 개요
- [FREEMIUM_SUMMARY.md](./FREEMIUM_SUMMARY.md) - Freemium 모델 상세 설명
- [ALGORITHM_LEARNING_SYSTEM.md](./ALGORITHM_LEARNING_SYSTEM.md) - 알고리즘 학습 시스템 가이드
- [AGENT_LIGHTNING_INTEGRATION.md](./AGENT_LIGHTNING_INTEGRATION.md) - Agent Lightning 통합 가이드
- [DATABASE_IMPROVEMENTS.md](./DATABASE_IMPROVEMENTS.md) - 데이터베이스 개선 사항

