# Admin 대시보드 구현 계획

## 📋 기본 정보

- **기능명**: Admin 대시보드
- **명세서**: [spec.md](./spec.md)
- **예상 소요 시간**: 2-3주
- **작성일**: 2025-12-04
- **작성자**: chunghyo, cursor ai(AI CODE IDE)

---

## 🎯 구현 개요

### 목표
관리자가 사용자 활동, 로그인 이력, 분석 결과를 모니터링하고 종합적인 AI 리포트를 생성할 수 있는 관리자 대시보드를 구축

### 범위
- **포함 사항**: 
  - 관리자 인증 및 권한 관리
  - 사용자 로그인 이력 조회 (소셜 로그인별 분류)
  - 사용자별 분석 이력 모니터링
  - 사용자별 분석 통계 (횟수, URL, 점수)
  - 일일 방문수 및 활동 통계
  - AI 리포트 생성
  - 분석 결과 DB 적재 및 AI 학습 연동
- **제외 사항**: 
  - 사용자 계정 직접 수정 (향후 추가)
  - 실시간 알림 시스템 (향후 추가)

### 주요 의존성
- 기존 인증 시스템 (NextAuth.js)
- 기존 데이터베이스 스키마
- Gemini API (AI 리포트 생성)
- 알고리즘 학습 시스템 (분석 결과 활용)

---

## 📅 구현 단계

### Phase 1: 관리자 인증 및 권한 관리 (2일)

#### Task 1.1: 관리자 권한 확인 미들웨어
- **파일**: `lib/admin-auth.ts`
- **내용**: 
  - 관리자 권한 확인 함수
  - API 라우트 미들웨어
  - 페이지 미들웨어
- **의존성**: 없음
- **예상 시간**: 4시간

#### Task 1.2: 관리자 전용 API 라우트 보호
- **파일**: `app/api/admin/**/route.ts`
- **내용**: 
  - 모든 Admin API에 권한 확인 미들웨어 적용
  - 권한 없음 시 403 에러 반환
- **의존성**: Task 1.1
- **예상 시간**: 2시간

#### Task 1.3: 관리자 전용 페이지 보호
- **파일**: `app/admin/**/page.tsx`
- **내용**: 
  - 페이지 레벨 권한 확인
  - 권한 없음 시 리다이렉트
- **의존성**: Task 1.1
- **예상 시간**: 2시간

#### Task 1.4: 관리자 활동 로그
- **파일**: `lib/admin-helpers.ts`
- **내용**: 
  - 관리자 활동 로그 저장 함수
  - 모든 Admin 작업에 로그 기록
- **의존성**: Task 1.1
- **예상 시간**: 2시간

---

### Phase 2: 사용자 로그인 이력 조회 (3일)

#### Task 2.1: 로그인 이력 조회 API
- **파일**: `app/api/admin/auth-logs/route.ts`
- **내용**: 
  - Provider별 필터링
  - 날짜별 필터링
  - 사용자별 필터링
  - 페이지네이션
  - 통계 요약
- **의존성**: Phase 1 완료
- **예상 시간**: 6시간

#### Task 2.2: 로그인 이력 헬퍼 함수
- **파일**: `lib/admin-helpers.ts`
- **내용**: 
  - 데이터베이스 쿼리 함수
  - 통계 계산 함수
  - 필터링 로직
- **의존성**: Task 2.1
- **예상 시간**: 4시간

#### Task 2.3: 로그인 이력 페이지
- **파일**: `app/admin/auth-logs/page.tsx`
- **내용**: 
  - 로그인 이력 목록 표시
  - 필터링 UI
  - 페이지네이션 UI
  - 통계 요약 카드
- **의존성**: Task 2.1
- **예상 시간**: 6시간

---

### Phase 3: 사용자 목록 및 분석 이력 모니터링 (4일)

#### Task 3.1: 사용자 목록 조회 API
- **파일**: `app/api/admin/users/route.ts`
- **내용**: 
  - 사용자 목록 조회
  - Provider별 필터링
  - 검색 기능
  - 페이지네이션
  - 사용자별 통계 포함
- **의존성**: Phase 1 완료
- **예상 시간**: 6시간

#### Task 3.2: 사용자별 분석 이력 조회 API
- **파일**: `app/api/admin/users/[userId]/analyses/route.ts`
- **내용**: 
  - 사용자별 분석 이력 조회
  - 날짜별 필터링
  - 점수별 필터링
  - 통계 계산
- **의존성**: Task 3.1
- **예상 시간**: 4시간

#### Task 3.3: 사용자별 분석 URL 목록 API
- **파일**: `app/api/admin/users/[userId]/urls/route.ts`
- **내용**: 
  - 사용자별 분석 URL 목록
  - URL별 분석 횟수
  - URL별 평균 점수
- **의존성**: Task 3.2
- **예상 시간**: 3시간

#### Task 3.4: 사용자 관리 페이지
- **파일**: `app/admin/users/page.tsx`
- **내용**: 
  - 사용자 목록 표시
  - 검색 및 필터링 UI
  - 사용자 상세 정보 모달
  - 사용자별 통계 표시
- **의존성**: Task 3.1
- **예상 시간**: 8시간

#### Task 3.5: 사용자 상세 페이지
- **파일**: `app/admin/users/[userId]/page.tsx`
- **내용**: 
  - 사용자 상세 정보
  - 분석 이력 목록
  - 분석 URL 목록
  - 통계 및 차트
- **의존성**: Task 3.2, Task 3.3
- **예상 시간**: 6시간

---

### Phase 4: 통계 및 활동 측정 (4일)

#### Task 4.1: 일일 방문수 및 활동 통계 API
- **파일**: `app/api/admin/daily-statistics/route.ts`
- **내용**: 
  - 일일 방문수 (누적, 개별)
  - 일일 활동 수
  - 날짜 범위 필터링
  - Provider별 통계
- **의존성**: Phase 1 완료
- **예상 시간**: 6시간

#### Task 4.2: 사용자별 분석 통계 API
- **파일**: `app/api/admin/users/[userId]/statistics/route.ts`
- **내용**: 
  - 사용자별 총 분석 건수
  - 평균 점수 계산
  - 점수 분포 계산
  - 최고/최저 점수
- **의존성**: Phase 3 완료
- **예상 시간**: 4시간

#### Task 4.3: 통계 헬퍼 함수
- **파일**: `lib/admin-helpers.ts`
- **내용**: 
  - 통계 계산 함수
  - 데이터 집계 함수
  - 차트 데이터 변환 함수
- **의존성**: Task 4.1, Task 4.2
- **예상 시간**: 4시간

#### Task 4.4: 통계 대시보드 페이지
- **파일**: `app/admin/statistics/page.tsx`
- **내용**: 
  - 일일 방문수 차트
  - 활동 수 차트
  - 통계 요약 카드
  - 날짜 범위 선택
  - CSV 내보내기 (선택적)
- **의존성**: Task 4.1
- **예상 시간**: 8시간

---

### Phase 5: AI 리포트 생성 (5일)

#### Task 5.1: AI 리포트 생성 API
- **파일**: `app/api/admin/ai-report/route.ts`
- **내용**: 
  - 전체 사용자 데이터 수집
  - Gemini API 연동
  - 리포트 생성 프롬프트 작성
  - 리포트 저장
- **의존성**: Phase 1 완료
- **예상 시간**: 8시간

#### Task 5.2: 리포트 프롬프트 생성
- **파일**: `lib/admin-report-prompt.ts`
- **내용**: 
  - 리포트 프롬프트 템플릿
  - 데이터 요약 함수
  - 트렌드 분석 함수
- **의존성**: Task 5.1
- **예상 시간**: 4시간

#### Task 5.3: 리포트 저장 시스템
- **파일**: `lib/admin-helpers.ts`
- **내용**: 
  - ai_reports 테이블 생성 (마이그레이션)
  - 리포트 저장 함수
  - 리포트 조회 함수
- **의존성**: Task 5.1
- **예상 시간**: 3시간

#### Task 5.4: AI 리포트 페이지
- **파일**: `app/admin/reports/page.tsx`
- **내용**: 
  - 리포트 생성 UI
  - 리포트 목록 표시
  - 리포트 상세 보기
  - 마크다운 렌더링
  - PDF 다운로드 (선택적)
- **의존성**: Task 5.1
- **예상 시간**: 8시간

---

### Phase 6: 분석 결과 DB 적재 및 AI 학습 연동 (2일)

#### Task 6.1: 학습 데이터 추출 함수
- **파일**: `lib/admin-helpers.ts`
- **내용**: 
  - 분석 결과에서 학습 데이터 추출
  - 데이터 정제
  - 특징 추출
- **의존성**: Phase 1 완료
- **예상 시간**: 4시간

#### Task 6.2: 알고리즘 학습 시스템 연동
- **파일**: `lib/admin-helpers.ts`
- **내용**: 
  - 알고리즘 학습 API 호출
  - 학습 데이터 전송
  - 학습 메트릭 추적
- **의존성**: Task 6.1, 알고리즘 학습 시스템
- **예상 시간**: 4시간

#### Task 6.3: 자동 학습 스케줄러 (선택적)
- **파일**: `app/api/admin/trigger-learning/route.ts`
- **내용**: 
  - 주기적으로 학습 데이터 추출
  - 알고리즘 학습 트리거
  - 학습 결과 모니터링
- **의존성**: Task 6.2
- **예상 시간**: 4시간

---

### Phase 7: Admin 대시보드 메인 페이지 (3일)

#### Task 7.1: 대시보드 메인 페이지
- **파일**: `app/admin/page.tsx`
- **내용**: 
  - 통계 요약 카드
  - 최근 활동 목록
  - 빠른 링크
  - 차트 및 그래프
- **의존성**: Phase 2-4 완료
- **예상 시간**: 8시간

#### Task 7.2: Admin 네비게이션
- **파일**: `components/AdminNavigation.tsx`
- **내용**: 
  - Admin 전용 네비게이션 메뉴
  - 활성 메뉴 표시
  - 반응형 디자인
- **의존성**: Task 7.1
- **예상 시간**: 3시간

#### Task 7.3: Admin 레이아웃
- **파일**: `app/admin/layout.tsx`
- **내용**: 
  - Admin 전용 레이아웃
  - 네비게이션 포함
  - 권한 확인
- **의존성**: Task 7.2
- **예상 시간**: 2시간

---

### Phase 8: 테스트 및 최적화 (3일)

#### Task 8.1: 단위 테스트 작성
- **파일**: `__tests__/admin/**/*.test.ts`
- **내용**: 
  - 관리자 권한 확인 테스트
  - 통계 계산 함수 테스트
  - 데이터 필터링 함수 테스트
- **의존성**: Phase 1-7 완료
- **예상 시간**: 6시간

#### Task 8.2: 통합 테스트 작성
- **파일**: `__tests__/admin/**/*.test.ts`
- **내용**: 
  - Admin API 엔드포인트 테스트
  - 데이터베이스 쿼리 테스트
  - AI 리포트 생성 테스트
- **의존성**: Task 8.1
- **예상 시간**: 6시간

#### Task 8.3: 성능 최적화
- **내용**: 
  - 데이터베이스 쿼리 최적화
  - 캐싱 적용
  - 페이지네이션 개선
  - 로딩 상태 개선
- **의존성**: Phase 1-7 완료
- **예상 시간**: 6시간

#### Task 8.4: 수동 테스트 및 버그 수정
- **내용**: 
  - 전체 플로우 테스트
  - 버그 수정
  - UI/UX 개선
- **의존성**: Task 8.3
- **예상 시간**: 6시간

---

## 🔄 마이그레이션 계획

### 데이터베이스 마이그레이션

#### 마이그레이션 1: ai_reports 테이블 생성
- **파일**: `database/migrations/xxx_create_ai_reports_table.sql`
- **내용**: 
  - ai_reports 테이블 생성
  - 인덱스 생성
- **의존성**: 없음
- **롤백**: 테이블 삭제

### 스키마 변경
- 기존 테이블 활용 (users, auth_logs, analyses, user_activity_statistics)
- 새로 생성: ai_reports 테이블

### 롤백 계획
- ai_reports 테이블 삭제
- Admin API 엔드포인트 비활성화
- Admin 페이지 접근 차단

---

## ⚠️ 리스크 관리

### 기술적 리스크
- **리스크**: 대량 데이터 조회 시 성능 저하
  - **확률**: Medium
  - **영향**: High
  - **대응 방안**: 페이지네이션, 캐싱, 인덱스 최적화

- **리스크**: AI 리포트 생성 시간 초과
  - **확률**: Medium
  - **영향**: Medium
  - **대응 방안**: 비동기 처리, 진행 상태 표시, 타임아웃 설정

### 일정 리스크
- **리스크**: 예상 시간 초과
  - **확률**: Medium
  - **대응 방안**: 우선순위 낮은 기능 제외 (PDF 다운로드, 자동 학습 스케줄러 등)

### 보안 리스크
- **리스크**: 관리자 권한 우회
  - **확률**: Low
  - **영향**: Critical
  - **대응 방안**: 다중 권한 확인, 활동 로그, 정기 보안 감사

---

## 📊 진행 상황 추적

### 진행률
- **전체 진행률**: 0%
- **Phase 1**: 0%
- **Phase 2**: 0%
- **Phase 3**: 0%
- **Phase 4**: 0%
- **Phase 5**: 0%
- **Phase 6**: 0%
- **Phase 7**: 0%
- **Phase 8**: 0%

---

## 🔗 관련 문서

- [명세서](./spec.md)
- [프로젝트 Constitution](../../memory/constitution.md)
- [알고리즘 학습 시스템 명세서](../004-algorithm-learning/spec.md)

---

## ✅ 구현 계획 검증 체크리스트

- [x] 구현 단계 논리적 순서
- [x] 의존성 올바름
- [x] 예상 소요 시간 현실적
- [x] 리스크 식별 및 대응 계획
- [x] 마이그레이션 계획 명확함
- [x] 롤백 계획 명확함
- [x] 테스트 계획 포함됨

---

**구현 계획 버전**: 1.0  
**최종 업데이트**: 2025-12-04  
**다음 단계**: [Tasks 작성](./tasks.md)

